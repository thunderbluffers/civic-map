{% block api_js %}
  <script src="https://maps.google.com/maps/api/js?key={{ api_key }}"></script>
{% endblock %}

{% block html %}
  <!-- HTML map container -->
  <div id="map-canvas-{{ map.pk }}"
    {% if lat and lng %}
      style="width: {{ width }}px; height: {{ height }}px;"
    {% endif %}
    class="easy-map-googlemap">
    {% block noscript %}{% if lat and lng %}
      <noscript>
        <img alt="Map of {{ map.address }}" src="https://maps.google.com/maps/api/staticmap?center={{ lat }},{{ lng }}&amp;zoom={{ zoom }}&amp;markers={{ lat }},{{ lng }}&amp;size={{ width }}x{{ height }}&amp;key={{ api_key }}">
      </noscript>
    {% endif %}{% endblock %}
    {% if not lat or not lng %}<!-- geocoding error -->{% endif %}
  </div>
{% endblock %}

{% block map_js %}
{% if lat and lng %}
  <!-- Map creation script -->
  <script type="text/javascript">
    function initialize_map_{{ map.pk }}() {
        var latlng = new google.maps.LatLng({{ lat }}, {{ lng }});
        var mapElem = document.getElementById("map-canvas-{{ map.pk }}");

        {% block map_options_js %}
            var mapOptions = {
                zoom: {{ zoom }},
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
        {% endblock %}

        var map = new google.maps.Map(mapElem, mapOptions);

        window.markers = [];
        {% block extra_js %}
            {% if setMarker == True %}
              var marker = new google.maps.Marker({
                  position: latlng,
                  map: map,
                  title: "{{ map.address }}"
              });
              window.markers.push(marker);
            {% endif %}
        {% endblock %}

        window.mapElem = mapElem;
        window.map = map;
    }

    {% block map_loading_js %}
        // initialize the map after page loading
        google.maps.event.addDomListener(window, 'load', initialize_map_{{ map.pk }});
    {% endblock %}
  </script>
{% endif %}
{% endblock %}
